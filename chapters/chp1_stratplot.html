<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Stratigraphic Plotting – Concepts of Paleoecology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/introduction.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-364982630eef5352dd1537128a8ed5cb.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/chp1_stratplot.html"><span class="chapter-title">Stratigraphic Plotting</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Concepts of Paleoecology</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Concepts of Paleoecology</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/chp1_stratplot.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Stratigraphic Plotting</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#plotting-with-rioja" id="toc-plotting-with-rioja" class="nav-link" data-scroll-target="#plotting-with-rioja">Plotting with Rioja</a>
  <ul class="collapse">
  <li><a href="#substituting-age-for-depth" id="toc-substituting-age-for-depth" class="nav-link" data-scroll-target="#substituting-age-for-depth">Substituting Age for Depth</a></li>
  <li><a href="#scale-factor" id="toc-scale-factor" class="nav-link" data-scroll-target="#scale-factor">Scale Factor</a></li>
  <li><a href="#column-order" id="toc-column-order" class="nav-link" data-scroll-target="#column-order">Column Order</a></li>
  <li><a href="#coniss" id="toc-coniss" class="nav-link" data-scroll-target="#coniss">CONISS</a></li>
  <li><a href="#summary-panel" id="toc-summary-panel" class="nav-link" data-scroll-target="#summary-panel">Summary Panel</a></li>
  <li><a href="#other-changes" id="toc-other-changes" class="nav-link" data-scroll-target="#other-changes">Other Changes</a></li>
  </ul></li>
  <li><a href="#plotting-with-tilia" id="toc-plotting-with-tilia" class="nav-link" data-scroll-target="#plotting-with-tilia">Plotting with Tilia</a>
  <ul class="collapse">
  <li><a href="#formatting-data" id="toc-formatting-data" class="nav-link" data-scroll-target="#formatting-data">Formatting data</a></li>
  <li><a href="#pasting-data-into-tilia" id="toc-pasting-data-into-tilia" class="nav-link" data-scroll-target="#pasting-data-into-tilia">Pasting data into Tilia</a></li>
  <li><a href="#modifying-pollen-diagram" id="toc-modifying-pollen-diagram" class="nav-link" data-scroll-target="#modifying-pollen-diagram">Modifying Pollen Diagram</a></li>
  <li><a href="#visualizing-summary-dynamics" id="toc-visualizing-summary-dynamics" class="nav-link" data-scroll-target="#visualizing-summary-dynamics">Visualizing Summary Dynamics</a></li>
  <li><a href="#cluster-analysis" id="toc-cluster-analysis" class="nav-link" data-scroll-target="#cluster-analysis">Cluster Analysis</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">Stratigraphic Plotting</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>Stratigraphic plotting enables visualization of patterns in the fossil archive for a wide range of proxy types analyzed as assemblages (e.g., pollen, diatoms, cladocerans, chironomids, etc.). In order to plot stratigraphic data, all you need are counts of a fossil assemblage, identified to arbitrary taxonomic resolution, with depth. An age-depth model allows for the conversion of depths to ages, thereby enabling comparison across sites and with independent chronologies of climate, but such a model is not strictly necessary for the plotting of stratigraphic data.</p>
<p>In 1980, the Quaternary paleoecologist John Birks wrote that computer-drawn pollen diagrams “are very useful for preliminary arrangement and interpretation of the data …. However, [they] are not sufficiently good for publication, and diagrams for publication must still be drafted by hand.” In the 2020s, all published pollen diagrams are computer-generated. One wonders whether the deliberate process of hand drawing encouraged earlier generations of paleoecologists to think more deeply about the patterns they were representing. But today’s users can rapidly reconfigure their diagrams in an iterative interpretation process and finally create highly customized visualizations using the array of software tools which now exist. In this chapter, we’ll focus on just two: the R package <code>Rioja</code> and the Tilia software.</p>
</section>
<section id="plotting-with-rioja" class="level2">
<h2 class="anchored" data-anchor-id="plotting-with-rioja">Plotting with Rioja</h2>
<p>In order to plot some pollen data using the R package <code>rioja</code>, we need to call it using the <code>library()</code> function as below. We’ll plot the sample data provided with the package, <code>aber</code>, which are “pollen stratigraphic data from Abernethy Forest, Scotland, spanning approximately 5500 - 12100 BP (from Birks &amp; Mathews 1978).” The aber object is a list with three components:</p>
<ul>
<li>spec - the actual pollen spectra, 49 rows of samples named by depth of 36 taxa arranged as columns, formatted as percentages</li>
<li>ages - a table mapping depths to uncalibrated and calibrated radiocarbon years, and</li>
<li>names - a table mapping taxa codes in spec to full taxonomic names and ecological group</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rioja)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="do">## for easier data manipulation</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(aber)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s take a closer look at spec. One thing we might want to do to ensure data quality is make sure the percentages aren’t obviously wrong. All the pollen percentages for any given row should sum to 100, since each individual pollen percentage is the relative abundance of that taxon at that depth. Let’s see if the data meet this expectation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rowSums</span>(aber<span class="sc">$</span>spec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   300    305    310    315    320    325    330    335    340    345    350 
 99.42  99.82 100.01  99.54  99.81  99.98  99.98  99.82  99.99  99.47  99.48 
   355    357    360    363    365    367    370    373    375    405    410 
 99.68  99.79  99.85  99.78  99.99  99.57  99.83  99.81  99.48  99.48  99.14 
   415    420    425    430    435    440    445    450    455    460    465 
 99.46  98.94  98.63  99.46  99.47  98.75  98.62  99.52  99.36  98.48  99.29 
   470    475    480    485    490    500    505    510    515    520    525 
 97.60  97.92  96.83  97.08  99.33  97.40  98.20  98.75  99.03  99.64  98.94 
   530    535    540    545    550 
 98.55  98.76 100.00  99.02  99.99 </code></pre>
</div>
</div>
<p>It’s not perfect, but they add up more or less to 100 - good! Let’s actually try plotting the data now, using the <code>strat.plot</code> function. The first argument of the function is the pollen spectra to be represented, and we add two additional arguments. Setting <code>scale.percent</code> to true gives a better visualization for percentage data, and setting <code>y.rev</code> to true reverses the y axis, so larger values are below smaller values. This is a standard convention for stratigraphic plots, where age and depth increase as you proceed further down the core.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">strat.plot</span>(aber<span class="sc">$</span>spec, <span class="at">scale.percent=</span><span class="cn">TRUE</span>, <span class="at">y.rev=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chp1_stratplot_files/figure-html/three-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It looks pretty good! But one criticism we might make is that it’s a little hard to isolate any patterns of ecological change within the complexity. <i>Betula</i> seems to be dominant for a period before being superseded by <i>Pinus sylvestris</i>, but the other pollen taxa are hard to interpret. Many of them are such small percentages compared to <i>Betula</i> and <i>Pinus sylvestris</i> that it’s difficult to see what’s going on with them.</p>
<p>Because those smaller pollen percentages are so difficult to see and are only adding to the clutter at this point, we can choose remove them. This can be done systematically by eliminating all columns with a mean percentage of pollen less than, say, 3%. The following list comprehension achieves that.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>aber_streamlined1  <span class="ot">=</span> aber<span class="sc">$</span>spec[<span class="fu">colMeans</span>(aber<span class="sc">$</span>spec)<span class="sc">&gt;</span><span class="dv">3</span>]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">strat.plot</span>(aber_streamlined1, <span class="at">scale.percent=</span><span class="cn">TRUE</span>, <span class="at">y.rev=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chp1_stratplot_files/figure-html/four-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>That looks even better! A clearer story is emerging: we see an early period dominated by herbs and grasses, followed by an intermediate period of birch and hazel, and ending with an era dominated by pine (pine pollen, at least!).</p>
<section id="substituting-age-for-depth" class="level3">
<h3 class="anchored" data-anchor-id="substituting-age-for-depth">Substituting Age for Depth</h3>
<p>But how fast did these events occur? We can’t simply assume that depth is one-to-one with time, because as the vegetation tracked by this sediment core changed, the rate of sedimentation may well have changed too. One can imagine that a prairie landscape suggested at the bottom of the core, perhaps grazed by large herds of animals, would have greater disturbance and sedimentation then a later forest landscape, where tree roots are keeping the soil solidly in place.</p>
<p>Luckily, the aber dataset comes with a chronology that we can use in place of depth for our y axis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">strat.plot</span>(aber_streamlined1, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">yvar=</span>aber<span class="sc">$</span>ages<span class="sc">$</span><span class="st">`</span><span class="at">Age (years BP)</span><span class="st">`</span>, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale.percent=</span><span class="cn">TRUE</span>, </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">y.rev=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chp1_stratplot_files/figure-html/five-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>Substituting time for depth doesn’t wildly change our understanding of the dynamics at Abernethy. One of the biggest changes is that, actually, that earliest ecological period lasted longer than we might have guessed from the depth profile, suggesting a slower sedimentation rate then. Still, having a chronology is generally preferably to going by bare depth, since it enables comparison to other sites and allows us to disentangle real ecological change from change in sedimentation rate.</p>
</section>
<section id="scale-factor" class="level3">
<h3 class="anchored" data-anchor-id="scale-factor">Scale Factor</h3>
<p>Earlier, we grabbed just the most prevalent taxa at our site. But you may care about a taxon that doesn’t show up as abundantly in the pollen-record – perhaps because it’s insect-pollinated rather than wind-pollinated – but whose presences are meaningful, nonetheless. We can exaggerate the scale factor of these taxa in order to emphasize their importance. Let’s do so with the insect-pollinated taxa, <i>Veronica</i>.</p>
<p>First, we’ll bind the column of <i>Veronica</i> from the original dataframe to our most prevalent taxa. We’ll set plot.poly to TRUE to plot polygons, since we’ll want to change the fill colors, and we’ll also make sure the names are correctly formatted by explicitly renaming the column headings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>aber_exag <span class="ot">=</span> aber<span class="sc">$</span>spec<span class="sc">$</span>VERONICA <span class="sc">%&gt;%</span> <span class="fu">cbind</span>(aber_streamlined1)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aber_exag) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Veronica"</span>,<span class="st">"Betula"</span>,<span class="st">"Pinus sylvetris"</span>, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Corylus"</span>, <span class="st">"Salix"</span>, <span class="st">"Juniperus"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Empetrum"</span>,<span class="st">"Gramineae"</span>,<span class="st">"Cyperaceae"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Artemisia"</span>,<span class="st">"Rumexaceae"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">strat.plot</span>(aber_exag, </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">yvar=</span>aber<span class="sc">$</span>ages<span class="sc">$</span><span class="st">`</span><span class="at">Age (years BP)</span><span class="st">`</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale.percent=</span><span class="cn">TRUE</span>, </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">y.rev=</span><span class="cn">TRUE</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">plot.poly=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chp1_stratplot_files/figure-html/six-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>You can see above the non-exaggerated version of the graph. Because scale.percent is set to TRUE, <i>Veronica</i> appears very small. One option we have is simply to set scale.percent to FALSE, in which case all the columns will have equal width. Another option is to add in a logical vector as the value of the exag parameter, which will add in a shadow wherever exag is TRUE. Let’s show these options below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">strat.plot</span>(aber_exag, </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">yvar=</span>aber<span class="sc">$</span>ages<span class="sc">$</span><span class="st">`</span><span class="at">Age (years BP)</span><span class="st">`</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale.percent=</span><span class="cn">FALSE</span>, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">y.rev=</span><span class="cn">TRUE</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">plot.poly=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chp1_stratplot_files/figure-html/seven-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">strat.plot</span>(aber_exag, </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">yvar=</span>aber<span class="sc">$</span>ages<span class="sc">$</span><span class="st">`</span><span class="at">Age (years BP)</span><span class="st">`</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale.percent=</span><span class="cn">TRUE</span>, </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">y.rev=</span><span class="cn">TRUE</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">plot.poly=</span><span class="cn">TRUE</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">exag=</span><span class="fu">c</span>(<span class="cn">TRUE</span>,<span class="fu">rep</span>(<span class="cn">FALSE</span>,<span class="dv">10</span>)), </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">col.exag=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chp1_stratplot_files/figure-html/seven-2.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>A third option is shown below. You can multiply the actual values of the <i>Veronica</i> column by, say, a factor of 10, and then modify the color of the polygons themselves to visually indicate this. If you do this, you’ll want to be very careful to explain to your audience what the values of <i>Veronica</i> really mean. This will include changing the x-axis labels, perhaps in Illustrator to show, what the actual values are. You don’t want to falsify your data!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ver_exag <span class="ot">=</span> aber<span class="sc">$</span>spec<span class="sc">$</span>VERONICA<span class="sc">*</span><span class="dv">10</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>aber_exag2 <span class="ot">=</span>  ver_exag <span class="sc">%&gt;%</span> <span class="fu">cbind</span>(aber_streamlined1)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aber_exag2) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Veronica"</span>,<span class="st">"Betula"</span>,<span class="st">"Pinus sylvestris"</span>, </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Corylus"</span>, <span class="st">"Salix"</span>, <span class="st">"Juniperus"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Empetrum"</span>,<span class="st">"Gramineae"</span>,<span class="st">"Cyperaceae"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Artemisia"</span>,<span class="st">"Rumexaceae"</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="fu">strat.plot</span>(aber_exag2,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">yvar=</span>aber<span class="sc">$</span>ages<span class="sc">$</span><span class="st">`</span><span class="at">Age (years BP)</span><span class="st">`</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale.percent=</span><span class="cn">TRUE</span>, </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">y.rev=</span><span class="cn">TRUE</span>, </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">plot.poly=</span><span class="cn">TRUE</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">col.poly=</span><span class="fu">c</span>(<span class="st">"orange"</span>,<span class="fu">rep</span>(<span class="st">"yellow"</span>,<span class="dv">10</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chp1_stratplot_files/figure-html/eight-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>That looks pretty good. And as long as we’re modifying colors, we might as well show some other color changes you can make. You can change the colors of the bars in the plot as well as the overarching line:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">strat.plot</span>(aber_exag2,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">yvar=</span>aber<span class="sc">$</span>ages<span class="sc">$</span><span class="st">`</span><span class="at">Age (years BP)</span><span class="st">`</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale.percent=</span><span class="cn">TRUE</span>, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">y.rev=</span><span class="cn">TRUE</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">plot.poly=</span><span class="cn">TRUE</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">col.poly=</span><span class="fu">c</span>(<span class="st">"orange"</span>,<span class="fu">rep</span>(<span class="st">"yellow"</span>,<span class="dv">10</span>)),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">col.line=</span><span class="st">"red"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">col.bar=</span><span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chp1_stratplot_files/figure-html/ten-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="column-order" class="level3">
<h3 class="anchored" data-anchor-id="column-order">Column Order</h3>
<p>You may want to group like taxa together by habit. This can be easily achieved by reordering the columns in the dataframe you’re plotting, as follows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>aber_reordered <span class="ot">=</span> aber_exag2[,<span class="fu">c</span>(<span class="st">"Betula"</span>,<span class="st">"Pinus sylvestris"</span>, </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Corylus"</span>,<span class="st">"Salix"</span>,<span class="st">"Juniperus"</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Veronica"</span>,<span class="st">"Empetrum"</span>,<span class="st">"Gramineae"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Cyperaceae"</span>,<span class="st">"Artemisia"</span>,<span class="st">"Rumexaceae"</span>)]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">strat.plot</span>(aber_reordered,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">yvar=</span>aber<span class="sc">$</span>ages<span class="sc">$</span><span class="st">`</span><span class="at">Age (years BP)</span><span class="st">`</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale.percent=</span><span class="cn">TRUE</span>, </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">y.rev=</span><span class="cn">TRUE</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">plot.poly=</span><span class="cn">TRUE</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">col.poly=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"yellow"</span>,<span class="dv">5</span>),<span class="st">"orange"</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">rep</span>(<span class="st">"yellow"</span>,<span class="dv">5</span>)),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">col.line=</span><span class="st">"black"</span>,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">col.bar=</span><span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chp1_stratplot_files/figure-html/nine-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>Notice that we had to reconfigure the color vector when we reordered to make sure that Veronica stayed orange even as its position changed.</p>
</section>
<section id="coniss" class="level3">
<h3 class="anchored" data-anchor-id="coniss">CONISS</h3>
<p>You can also add a CONISS diagram to your stratigraphic plot in R. To do this, first you need to create a dissimilarity matrix from your data, which we’ll do with the R package <code>vegan</code>, and then use that matrix as an input to the <code>rioja</code> function chclust, the output of which can be plugged into the stratigraphic plot. One thing to be very careful of here is not to use the dataframe with the exaggerated values for <i>Veronica</i> when you make your dissimilarity matrix!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>dissim <span class="ot">=</span> <span class="fu">vegdist</span>(aber_exag)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>aber_clust <span class="ot">&lt;-</span> <span class="fu">chclust</span>(dissim, <span class="at">method =</span> <span class="st">"coniss"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">strat.plot</span>(aber_reordered,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">yvar=</span>aber<span class="sc">$</span>ages<span class="sc">$</span><span class="st">`</span><span class="at">Age (years BP)</span><span class="st">`</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale.percent=</span><span class="cn">TRUE</span>, </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">y.rev=</span><span class="cn">TRUE</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">plot.poly=</span><span class="cn">TRUE</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">col.poly=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"yellow"</span>,<span class="dv">5</span>),<span class="st">"orange"</span>,<span class="fu">rep</span>(<span class="st">"yellow"</span>,<span class="dv">5</span>)),</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">col.line=</span><span class="st">"black"</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">col.bar=</span><span class="st">"black"</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">clust=</span>aber_clust)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chp1_stratplot_files/figure-html/eleven-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="summary-panel" class="level3">
<h3 class="anchored" data-anchor-id="summary-panel">Summary Panel</h3>
<p><code>Rioja</code> doesn’t have great options for making a summary plot of herbs versus trees, but it is possible. I do so below by adding all the herb percentages together (in the non-<i>Veronica</i>-inflated dataframe) and binding it to my plotting dataframe. Then I just make sure the column is named properly, change its color in the plot, and add in a background color to make it easier to see the negative space in that plot. Unfortunately, there’s no simple way to modify the background color of each curve in <code>rioja</code> separately.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>aber_exag <span class="ot">=</span> aber_exag <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">all_herbs =</span> Veronica <span class="sc">+</span> Empetrum <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                  Gramineae <span class="sc">+</span> Cyperaceae <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                  Artemisia <span class="sc">+</span> Rumexaceae)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>aber_reordered <span class="ot">=</span> aber_reordered <span class="sc">%&gt;%</span> <span class="fu">cbind</span>(aber_exag<span class="sc">$</span>all_herbs)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aber_reordered)[<span class="dv">12</span>] <span class="ot">=</span> <span class="st">"Herbs versus Trees"</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="fu">strat.plot</span>(aber_reordered,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">yvar=</span>aber<span class="sc">$</span>ages<span class="sc">$</span><span class="st">`</span><span class="at">Age (years BP)</span><span class="st">`</span>,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">scale.percent=</span><span class="cn">TRUE</span>, </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">y.rev=</span><span class="cn">TRUE</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">plot.poly=</span><span class="cn">TRUE</span>,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">col.poly=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"yellow"</span>,<span class="dv">5</span>),<span class="st">"orange"</span>,<span class="fu">rep</span>(<span class="st">"yellow"</span>,<span class="dv">5</span>),<span class="st">'green'</span>),</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">col.line=</span><span class="st">"black"</span>,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">col.bar=</span><span class="st">"black"</span>,</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">col.bg=</span><span class="st">"tan"</span>,</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">clust=</span>aber_clust)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chp1_stratplot_files/figure-html/twelve-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="other-changes" class="level3">
<h3 class="anchored" data-anchor-id="other-changes">Other Changes</h3>
<p>We made a pretty sophisticated plot in <code>rioja</code>. To make further aesthetic changes, you might want to export your graphic as a .emf file and manipulate it further in Adobe Illustrator.</p>
</section>
</section>
<section id="plotting-with-tilia" class="level2">
<h2 class="anchored" data-anchor-id="plotting-with-tilia">Plotting with Tilia</h2>
<p>Tilia is a software program developed by Eric Grimm which enables users to upload their data into Neotoma, and also allows users to develop pollen diagrams, using Neotoma data or their own data. You can install Tilia by following the directions on this <a href="http://neotomadb.org/apps/tilia">page</a>.</p>
<section id="formatting-data" class="level3">
<h3 class="anchored" data-anchor-id="formatting-data">Formatting data</h3>
<p>In order to plot pollen data from a non-Neotoma source in Tilia, there is a preliminary data-formatting step. We want to convert our pollen counts into pollen percentages, which we will plot directly in Tilia. In order to calculate pollen percentages, we need to sum all the pollen counted at each sample depth and then divide each individual count by the count sum at that depth, as shown in the following video.</p>
<video width="640" controls="">
<source src="../videos/CountsToPercentages.mp4" type="video/mp4">
<p>Your browser does not support the video tag. </p>
</video></section>
<section id="pasting-data-into-tilia" class="level3">
<h3 class="anchored" data-anchor-id="pasting-data-into-tilia">Pasting data into Tilia</h3>
<p>Once the data are properly formatted, they can be pasted into a Tilia spreadsheet. In Tilia, each row corresponds to a taxon, and each column corresponds to a sample depth. Those sample depths can be indexed either as depths, ages, or both. Also, Tilia provides a “Group” column where the habit or ecological group of the taxon in question can be noted.</p>
<video width="640" controls="">
<source src="../videos/PastingDataIntoTilia.mp4" type="video/mp4">
<p>Your browser does not support the video tag. </p>
</video></section>
<section id="modifying-pollen-diagram" class="level3">
<h3 class="anchored" data-anchor-id="modifying-pollen-diagram">Modifying Pollen Diagram</h3>
<p>Once you’ve made the pollen diagram, there are some convenient ways to modify it in Tilia. These include</p>
<ul>
<li>rearranging columns</li>
<li>deleting columns that you don’t care about, and</li>
<li>exaggerating the scale of taxa that exhibit small but important changes.</li>
</ul>
<video width="640" controls="">
<source src="../videos/ModifyingPollenDiagram.mp4" type="video/mp4">
<p>Your browser does not support the video tag. </p>
</video></section>
<section id="visualizing-summary-dynamics" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-summary-dynamics">Visualizing Summary Dynamics</h3>
<p>Another addition to your plot that Tilia allows for is the creation of a summary panel that shows the broad vegetation dynamics, say, between herbs and trees. The following video shows how to create that summary panel.</p>
<video width="640" controls="">
<source src="../videos/SummaryPanelVegDynamics.mp4" type="video/mp4">
<p>Your browser does not support the video tag. </p>
</video></section>
<section id="cluster-analysis" class="level3">
<h3 class="anchored" data-anchor-id="cluster-analysis">Cluster Analysis</h3>
<p>Lastly, Tilia makes it easy to insert a stratigraphically constrained cluster analysis (CONISS) into your plot. Watch this video to learn how.</p>
<video width="640" controls="">
<source src="../videos/CONISS.mp4" type="video/mp4">
<p>Your browser does not support the video tag. </p>
</video></section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>In this module, we’ve walked through how to start building stratigraphic plots (with a focus on pollen data) using the R library Rioja and Eric Grimm’s Tilia. We hope that it has been helpful. Please reach out with any questions.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li>Birks Quaternary Paleoecology</li>
<li>Birks, HH &amp; Mathews, RW (1978). Studies in the vegetational history of Scotland V. Late Devensian and early Flandrian macrofossil stratigraphy at Abernethy Forest, Invernessshire. New Phytologist 80, 455-84.</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/introduction.html" class="pagination-link" aria-label="Introduction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>